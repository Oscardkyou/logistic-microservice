#!/bin/bash

# u0421u043au0440u0438u043fu0442 u0434u043bu044f u0440u0443u0447u043du043eu0433u043e u0434u0435u043fu043bu043eu044f u0431u0435u0437 Docker Compose

# u041eu0441u0442u0430u043du043eu0432u043au0430 u0438 u0443u0434u0430u043bu0435u043du0438u0435 u0441u0443u0449u0435u0441u0442u0432u0443u044eu0449u0438u0445 u043au043eu043du0442u0435u0439u043du0435u0440u043eu0432
echo "u041eu0441u0442u0430u043du0430u0432u043bu0438u0432u0430u044e u0438 u0443u0434u0430u043bu044fu044e u0441u0443u0449u0435u0441u0442u0432u0443u044eu0449u0438u0435 u043au043eu043du0442u0435u0439u043du0435u0440u044b..."
docker stop logistics-app logistics-nginx 2>/dev/null || true
docker rm logistics-app logistics-nginx 2>/dev/null || true

# u0421u043eu0437u0434u0430u043du0438u0435 u0441u0435u0442u0438, u0435u0441u043bu0438 u043eu043du0430 u0435u0449u0435 u043du0435 u0441u0443u0449u0435u0441u0442u0432u0443u0435u0442
echo "u0421u043eu0437u0434u0430u044e u0441u0435u0442u044c logistics-network..."
docker network create logistics-network 2>/dev/null || true

# u0421u0431u043eu0440u043au0430 u0438 u0437u0430u043fu0443u0441u043a u043au043eu043du0442u0435u0439u043du0435u0440u0430 u0441 u043fu0440u0438u043bu043eu0436u0435u043du0438u0435u043c
echo "u0421u043eu0431u0438u0440u0430u044e u0438 u0437u0430u043fu0443u0441u043au0430u044e u043au043eu043du0442u0435u0439u043du0435u0440 u0441 u043fu0440u0438u043bu043eu0436u0435u043du0438u0435u043c..."
docker build -t logistics-app-image .
docker run -d --name logistics-app \
  --network logistics-network \
  -p 8082:8082 \
  -v "$(pwd)/shipments.json:/app/shipments.json" \
  --restart always \
  logistics-app-image

# u0417u0430u043fu0443u0441u043a u043au043eu043du0442u0435u0439u043du0435u0440u0430 Nginx
echo "u0417u0430u043fu0443u0441u043au0430u044e u043au043eu043du0442u0435u0439u043du0435u0440 Nginx..."
docker run -d --name logistics-nginx \
  --network logistics-network \
  -p 8080:80 \
  -v "$(pwd)/nginx/nginx.conf:/etc/nginx/conf.d/default.conf" \
  --restart always \
  nginx:alpine

echo "u0414u0435u043fu043bu043eu0439 u0437u0430u0432u0435u0440u0448u0435u043d! u041fu0440u0438u043bu043eu0436u0435u043du0438u0435 u0434u043eu0441u0442u0443u043fu043du043e u043fu043e u0430u0434u0440u0435u0441u0443 http://localhost:8080"
